%rebase('base.html')
<script>
    function board_cell_click(event, x, row, col) {
        if (typeof event ==="object") {
            switch (event.which) {
                case 1:
                    document.getElementById("mouse_button").value = "left";
                    break;
                case 2:
                    event.preventDefault();
                    document.getElementById("mouse_button").value = "middle";
                    break;
                case 3:
                    document.getElementById("mouse_button").value = "right";
                    break;
                default:
                    return;
            }
        }
        document.getElementById("selected_row").value = row;
        document.getElementById("selected_col").value = col;
        document.forms["Board"].submit();
    }

    function new_game_click(event, x) {
        document.forms["Header"].submit();
    }    
</script>

<h1>Minolovec</h1>

<form name="Header" action ="/new/" method="POST">
<table cellspacing=0 cellpadding=0>
    <tr>
        %for col in range(board.get_width() + 2):
        <td> 
            %if col == 0:
            %    css_class = "bordertl"
            %elif col == board.get_width() + 1:
            %    css_class = "bordertr"
            %else:
            %    css_class = "bordertb"
            %end
            <div oncontextmenu="event.preventDefault();" class={{css_class}}></div>
        </td>
        %end
    </tr>
    <tr>
        <td>
            <div oncontextmenu="event.preventDefault();" class="borderlrlong"></div>
        </td>
        %mc_orig = board.get_remaining_mine_count()
        %mc_neg = (mc_orig < 0)
        %mc = abs(mc_orig)
        %t1 = mc % 10
        %mc = mc // 10
        %t10 = mc % 10
        %mc = mc // 10
        %t100 = mc % 10

        %if (mc_neg):
        %   time100 = "time-"
        %else:
        %   time100 = "time" + str(t100)
        %end
        %time10 = "time" + str(t10)
        %time1 = "time" + str(t1)
        <td colspan="3" class="blank">
            <div oncontextmenu="event.preventDefault();" class="{{time100}} mines_hundreds"></div>
            <div oncontextmenu="event.preventDefault();" class="{{time10}} mines_tens"></div>
            <div oncontextmenu="event.preventDefault();" class="{{time1}} mines_ones"></div>
        </td>
        %cells_together = board.get_width() - 6
        <td colspan="{{cells_together}}" class="blank">
            <div
                oncontextmenu="event.preventDefault();" 
                onmouseup="new_game_click(event, this)"
                class="facesmile">
        </td>
        <td colspan="3" class="blank">
            <div oncontextmenu="event.preventDefault();" class="time0 seconds_hundreds"></div>
            <div oncontextmenu="event.preventDefault();" class="time0 seconds_tens"></div>
            <div oncontextmenu="event.preventDefault();" class="time0 seconds_ones"></div>
        </td>
        <td>
            <div oncontextmenu="event.preventDefault();" class="borderlrlong"></div>
        </td>
    </tr>
</table>
</form>

<form name="Board" action="/open/" method="POST">
<table cellspacing=0 cellpadding=0>
    <tr>
        %for col in range(board.get_width() + 2):
        <td>
            %if col == 0:
            %    css_class = "borderjointl"
            %elif col == board.get_width() + 1:
            %    css_class = "borderjointr"
            %else:
            %    css_class = "bordertb"
            %end
            <div oncontextmenu="event.preventDefault();" class="{{css_class}}"></div>
        </td>
        %end
    </tr>
    %for row in range(board.get_height()):
    <tr>
        <td>
            <div oncontextmenu="event.preventDefault();" class="borderlr">
        </td>
        %for col in range(board.get_width()):
        <td>
            %if board.get_open(row, col):
            %    if board.get_mine(row, col):
            %       if board.get_exploded(row, col):
            %           css_class = "bombdeath"            
            %       elif board.get_marked(row, col):
            %           css_class = "marked"
            %       else:
            %           css_class = "bombrevealed"
            %       end
            %    else:
            %       if board.get_marked(row, col):
            %           css_class = "bombmisflagged"
            %        else:
            %           css_class =  "open" + str(board.get_neighbour_mine_count(row, col))
            %       end
            %    end
            %else:
            %    if board.get_marked(row, col):
            %       css_class ="marked"
            %    else:
            %       css_class = "closed"
            %    end
            %end
            %if board.is_game_in_progress():
            <div
                oncontextmenu="event.preventDefault();"
                onmouseup="board_cell_click(event, this, {{row}}, {{col}})"
                class="{{css_class}}">
            %else:
            <div
                oncontextmenu="event.preventDefault();"
                class="{{css_class}}">
            %end
        </td>    
        %end
        <td>
            <div oncontextmenu="event.preventDefault();" class="borderlr">
        </td>
    </tr>
    %end
    <tr>
        %for col in range(board.get_width() + 2):
        <td>
            %if col == 0:
            %    css_class = "borderbl"
            %elif col == board.get_width() + 1:
            %    css_class = "borderbr"
            %else:
            %    css_class = "bordertb"
            %end
            <div oncontextmenu="event.preventDefault();" class="{{css_class}}"></div>
        </td>
        %end
    </tr>
    </table>
    <input type="text" id="mouse_button" name="mouse_button" value="" style="display: none">
    <input type="number" id="selected_row" name="selected_row" value="" style="display: none">
    <input type="number" id="selected_col" name="selected_col" value="" style="display: none">  
</form>
