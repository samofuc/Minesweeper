%rebase('base.html')

<script>
    function mouse_click(event, x, row, col) {
        if (typeof event ==="object") {
            switch (event.which) {
                case 1:
                    document.getElementById("mouse_button").value = "left";
                    break;
                case 2:
                    event.preventDefault();
                    document.getElementById("mouse_button").value = "middle";
                    break;
                case 3:
                    document.getElementById("mouse_button").value = "right";
                    break;
                default:
                    return;
            }
        }
        document.getElementById("selected_row").value = row;
        document.getElementById("selected_col").value = col;
        document.forms["game"].submit();
    }
</script>

<form name="New game" action ="/new/" method="POST">
    <input type="submit" value="New game">
</form>

<p>Stevilo preostalih min: {{board.get_remaining_mine_count()}}</p>

<form name="game" action="/open/" method="POST">
    <h1>Igra</h1>
    <table>
    %for row in range(board.get_height()):
    <tr>
        %for col in range(board.get_width()):
        <td>
            %css_class = "closed"
            %if board.get_marked(row, col):
            %    css_class = "marked"
            %elif board.get_open(row, col):
            %    if board.get_mine(row, col):
            %        css_class = "bombdeath"
            %    else:
            %        css_class =  "open" + str(board.get_neighbour_mine_count(row, col))
            %    end
            %else:
            %    css_class = "closed"
            %end
            <div
                oncontextmenu="event.preventDefault();"
                onmouseup="mouse_click(event, this, {{row}}, {{col}})"
                class="{{css_class}}">
        </td>    
        %end
    </tr>
    %end
    </table>
    <input type="text" id="mouse_button" name="mouse_button" value="" style="display: none">
    <input type="number" id="selected_row" name="selected_row" value="" style="display: none">
    <input type="number" id="selected_col" name="selected_col" value="" style="display: none">  
</form>
<!--
<h1>Mine</h1>
<table>
%for row in range(board.get_height()):
<tr>
    %for col in range(board.get_width()):
    <td>
    <input type="submit" value="{{board.get_mine(row, col)}}">
    </td>    
    %end
</tr>
%end
</table>

<h1>Mine v sosedščini</h1>
<table>
%for row in range(board.get_height()):
<tr>
    %for col in range(board.get_width()):
    <td>
    <input type="submit" value="{{board.get_neighbour_mine_count(row, col)}}">
    </td>    
    %end
</tr>
%end
</table>
-->